(function(i,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("tippy.js")):typeof define=="function"&&define.amd?define(["exports","vue","tippy.js"],e):(i=typeof globalThis<"u"?globalThis:i||self,e(i.CalendarHeatmap={},i.Vue,i.tippy))})(this,function(i,e,f){"use strict";var ye=Object.defineProperty;var De=(i,e,f)=>e in i?ye(i,e,{enumerable:!0,configurable:!0,writable:!0,value:f}):i[e]=f;var E=(i,e,f)=>(De(i,typeof e!="symbol"?e+"":e,f),f);const d=class d{constructor(a,n,l){E(this,"startDate");E(this,"endDate");E(this,"max");E(this,"_values");E(this,"_firstFullWeekOfMonths");E(this,"_activities");E(this,"_calendar");this.endDate=this.parseDate(a),this.max=l||Math.ceil(Math.max(...n.map(c=>c.count))/5*4),this.startDate=this.shiftDate(a,-d.DAYS_IN_ONE_YEAR),this._values=n}set values(a){this.max=Math.ceil(Math.max(...a.map(n=>n.count))/5*4),this._values=a,this._firstFullWeekOfMonths=void 0,this._calendar=void 0,this._activities=void 0}get values(){return this._values}get activities(){if(!this._activities){this._activities=new Map;for(let a=0,n=this.values.length;a<n;a++)this._activities.set(this.keyDayParser(this.values[a].date),{count:this.values[a].count,colorIndex:this.getColorIndex(this.values[a].count)})}return this._activities}get weekCount(){return this.getDaysCount()/d.DAYS_IN_WEEK}get calendar(){if(!this._calendar){let a=this.shiftDate(this.startDate,-this.getCountEmptyDaysAtStart());a=new Date(a.getFullYear(),a.getMonth(),a.getDate()),this._calendar=new Array(this.weekCount);for(let n=0,l=this._calendar.length;n<l;n++){this._calendar[n]=new Array(d.DAYS_IN_WEEK);for(let c=0;c<d.DAYS_IN_WEEK;c++){const s=this.activities.get(this.keyDayParser(a));this._calendar[n][c]={date:new Date(a.valueOf()),count:s?s.count:void 0,colorIndex:s?s.colorIndex:0},a.setDate(a.getDate()+1)}}}return this._calendar}get firstFullWeekOfMonths(){if(!this._firstFullWeekOfMonths){const a=this.calendar;this._firstFullWeekOfMonths=[];for(let n=1,l=a.length;n<l;n++){const c=a[n-1][0].date,s=a[n][0].date;(c.getFullYear()<s.getFullYear()||c.getMonth()<s.getMonth())&&this._firstFullWeekOfMonths.push({value:s.getMonth(),index:n})}}return this._firstFullWeekOfMonths}getColorIndex(a){return a==null?0:a<=0?1:a>=this.max?5:Math.ceil(a*100/this.max*.03)+1}getCountEmptyDaysAtStart(){return this.startDate.getDay()}getCountEmptyDaysAtEnd(){return d.DAYS_IN_WEEK-1-this.endDate.getDay()}getDaysCount(){return d.DAYS_IN_ONE_YEAR+1+this.getCountEmptyDaysAtStart()+this.getCountEmptyDaysAtEnd()}shiftDate(a,n){const l=new Date(a);return l.setDate(l.getDate()+n),l}parseDate(a){return a instanceof Date?a:new Date(a)}keyDayParser(a){const n=this.parseDate(a);return String(n.getFullYear())+String(n.getMonth()).padStart(2,"0")+String(n.getDate()).padStart(2,"0")}};E(d,"DEFAULT_RANGE_COLOR_LIGHT",["#ebedf0","#dae2ef","#c0ddf9","#73b3f3","#3886e1","#17459e"]),E(d,"DEFAULT_RANGE_COLOR_DARK",["#1f1f22","#1e334a","#1d466c","#1d5689","#1d69ac","#1B95D1"]),E(d,"DEFAULT_LOCALE",{months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],on:"on",less:"Less",more:"More"}),E(d,"DEFAULT_TOOLTIP_UNIT","contributions"),E(d,"DAYS_IN_ONE_YEAR",365),E(d,"DAYS_IN_WEEK",7),E(d,"SQUARE_SIZE",10);let o=d;const Ae="",Re="",M=e.defineComponent({name:"CalendarHeatmap",props:{endDate:{required:!0},max:{type:Number},rangeColor:{type:Array},values:{type:Array,required:!0},locale:{type:Object},tooltip:{type:Boolean,default:!0},tooltipUnit:{type:String,default:o.DEFAULT_TOOLTIP_UNIT},tooltipFormatter:{type:Function},vertical:{type:Boolean,default:!1},noDataText:{type:[Boolean,String],default:null},round:{type:Number,default:0},darkMode:Boolean},emits:["dayClick"],setup(t){const a=o.SQUARE_SIZE/5,n=o.SQUARE_SIZE+a,l=Math.ceil(o.SQUARE_SIZE*2.5),c=n*3,s=o.SQUARE_SIZE+o.SQUARE_SIZE/2,_=o.SQUARE_SIZE+o.SQUARE_SIZE/2,h=`translate(${l}, ${s})`,I=e.ref(null),D=e.ref(new Date),S=e.ref(new o(t.endDate,t.values,t.max)),A=e.ref(0),R=e.ref(0),B=e.ref("0 0 0 0"),C=e.ref("0 0 0 0"),T=e.ref(""),O=e.ref(""),L=e.ref(""),y=e.ref({}),p=e.ref(t.rangeColor||(t.darkMode?o.DEFAULT_RANGE_COLOR_DARK:o.DEFAULT_RANGE_COLOR_LIGHT)),{values:ie,tooltipUnit:de,tooltipFormatter:Ee,noDataText:ce,max:_e,vertical:Q,locale:he}=e.toRefs(t),g=new Map;let m;function Z(){g.clear(),m?m.setInstances(Array.from(g.values())):m=f.createSingleton(Array.from(g.values()),{overrides:[],moveTransition:"transform 0.1s ease-out",allowHTML:!0})}function fe(r){if(t.tooltip){if(r.count!==void 0)return t.tooltipFormatter?t.tooltipFormatter(r,t.tooltipUnit):`<b>${r.count} ${t.tooltipUnit}</b> ${y.value.on} ${y.value.months[r.date.getMonth()]} ${r.date.getDate()}, ${r.date.getFullYear()}`;if(t.noDataText)return`${t.noDataText}`;if(t.noDataText!==!1)return`<b>No ${t.tooltipUnit}</b> ${y.value.on} ${y.value.months[r.date.getMonth()]} ${r.date.getDate()}, ${r.date.getFullYear()}`}}function Se(r){return t.vertical?`translate(0, ${n*S.value.weekCount-(r+1)*n})`:`translate(${r*n}, 0)`}function ge(r){return t.vertical?`translate(${r*n}, 0)`:`translate(0, ${r*n})`}function me(r){return t.vertical?{x:3,y:n*S.value.weekCount-n*r.index-n/4}:{x:n*r.index,y:n-a}}e.watch([e.toRef(t,"rangeColor"),e.toRef(t,"darkMode")],([r,u])=>{p.value=r||(u?o.DEFAULT_RANGE_COLOR_DARK:o.DEFAULT_RANGE_COLOR_LIGHT)}),e.watch(Q,r=>{r?(A.value=l+n*o.DAYS_IN_WEEK+c,R.value=s+n*S.value.weekCount+a,T.value=`translate(${l}, 0)`,O.value=`translate(0, ${s})`):(A.value=l+n*S.value.weekCount+a,R.value=s+n*o.DAYS_IN_WEEK,T.value=`translate(0, ${s})`,O.value=`translate(${l}, 0)`)},{immediate:!0}),e.watch([A,R],([r,u])=>B.value=` 0 0 ${r} ${u}`,{immediate:!0}),e.watch([A,R,p],([r,u,k])=>{L.value=Q.value?`translate(${l+n*o.DAYS_IN_WEEK}, ${s})`:`translate(${r-n*k.length-30}, ${u-_})`},{immediate:!0}),e.watch(he,r=>y.value=r?{...o.DEFAULT_LOCALE,...r}:o.DEFAULT_LOCALE,{immediate:!0}),e.watch(p,r=>C.value=`0 0 ${o.SQUARE_SIZE*(r.length+1)} ${o.SQUARE_SIZE}`,{immediate:!0}),e.watch([ie,de,Ee,ce,_e,p],()=>{S.value=new o(t.endDate,t.values,t.max),g.forEach(r=>r.destroy()),e.nextTick(Z)}),e.onMounted(Z),e.onBeforeUnmount(()=>{m==null||m.destroy(),g.forEach(r=>r.destroy())});function ue(r){if(m&&r.target&&r.target.classList.contains("vch__day__square")&&r.target.dataset.weekIndex!==void 0&&r.target.dataset.dayIndex!==void 0){const u=Number(r.target.dataset.weekIndex),k=Number(r.target.dataset.dayIndex);if(!isNaN(u)&&!isNaN(k)){const w=fe(S.value.calendar[u][k]);if(w){const N=g.get(r.target);N?N.setContent(w):N||(g.set(r.target,f(r.target,{content:w})),m.setInstances(Array.from(g.values())))}}}}return{SQUARE_BORDER_SIZE:a,SQUARE_SIZE:n,LEFT_SECTION_WIDTH:l,RIGHT_SECTION_WIDTH:c,TOP_SECTION_HEIGHT:s,BOTTOM_SECTION_HEIGHT:_,svg:I,heatmap:S,now:D,width:A,height:R,viewbox:B,daysLabelWrapperTransform:T,monthsLabelWrapperTransform:O,yearWrapperTransform:h,legendWrapperTransform:L,lo:y,legendViewbox:C,curRangeColor:p,getWeekPosition:Se,getDayPosition:ge,getMonthLabelPosition:me,initTippyLazy:ue}}}),pe="",F=(t,a)=>{const n=t.__vccOpts||t;for(const[l,c]of a)n[l]=c;return n},$=["viewBox"],b=["transform"],W=["x","y"],v=["transform"],V=["x","y"],Y=["x","y"],P=["x","y"],G=["transform"],K=["x"],H=["rx","ry","width","height","x","y"],z=["x","y"],j=["transform"],q=["transform"],J=["rx","ry","transform","width","height","data-week-index","data-day-index","onClick"],X={class:"vch__legend"},x={class:"vch__legend-left"},ee={class:"vch__legend-right"},te={class:"vch__legend"},ae=["viewBox","height"],ne={class:"vch__legend__wrapper"},re=["rx","ry","width","height","x"];function oe(t,a,n,l,c,s){return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({vch__container:!0,"dark-mode":t.darkMode})},[(e.openBlock(),e.createElementBlock("svg",{class:"vch__wrapper",ref:"svg",viewBox:t.viewbox},[e.createElementVNode("g",{class:"vch__months__labels__wrapper",transform:t.monthsLabelWrapperTransform},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.heatmap.firstFullWeekOfMonths,(_,h)=>(e.openBlock(),e.createElementBlock("text",{class:"vch__month__label",key:h,x:t.getMonthLabelPosition(_).x,y:t.getMonthLabelPosition(_).y},e.toDisplayString(t.lo.months[_.value]),9,W))),128))],8,b),e.createElementVNode("g",{class:"vch__days__labels__wrapper",transform:t.daysLabelWrapperTransform},[e.createElementVNode("text",{class:"vch__day__label",x:t.vertical?t.SQUARE_SIZE:0,y:t.vertical?t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE:20},e.toDisplayString(t.lo.days[1]),9,V),e.createElementVNode("text",{class:"vch__day__label",x:t.vertical?t.SQUARE_SIZE*3:0,y:t.vertical?t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE:44},e.toDisplayString(t.lo.days[3]),9,Y),e.createElementVNode("text",{class:"vch__day__label",x:t.vertical?t.SQUARE_SIZE*5:0,y:t.vertical?t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE:69},e.toDisplayString(t.lo.days[5]),9,P)],8,v),t.vertical?(e.openBlock(),e.createElementBlock("g",{key:0,class:"vch__legend__wrapper",transform:t.legendWrapperTransform},[e.createElementVNode("text",{x:t.SQUARE_SIZE*1.25,y:"8"},e.toDisplayString(t.lo.less),9,K),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.curRangeColor,(_,h)=>(e.openBlock(),e.createElementBlock("rect",{key:h,rx:t.round,ry:t.round,style:e.normalizeStyle({fill:_}),width:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,height:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,x:t.SQUARE_SIZE*1.75,y:t.SQUARE_SIZE*(h+1)},null,12,H))),128)),e.createElementVNode("text",{x:t.SQUARE_SIZE*1.25,y:t.SQUARE_SIZE*(t.curRangeColor.length+2)-t.SQUARE_BORDER_SIZE},e.toDisplayString(t.lo.more),9,z)],8,G)):e.createCommentVNode("",!0),e.createElementVNode("g",{class:"vch__year__wrapper",transform:t.yearWrapperTransform,onMouseover:a[0]||(a[0]=(..._)=>t.initTippyLazy&&t.initTippyLazy(..._))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.heatmap.calendar,(_,h)=>(e.openBlock(),e.createElementBlock("g",{class:"vch__month__wrapper",key:h,transform:t.getWeekPosition(h)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(_,(I,D)=>(e.openBlock(),e.createElementBlock("rect",{key:D,class:"vch__day__square",rx:t.round,ry:t.round,transform:t.getDayPosition(D),width:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,height:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,style:e.normalizeStyle({fill:t.curRangeColor[I.colorIndex]}),"data-week-index":h,"data-day-index":D,onClick:S=>t.$emit("dayClick",I)},null,12,J))),128))],8,q))),128))],40,j)],8,$)),e.createElementVNode("div",X,[e.renderSlot(t.$slots,"legend",{},()=>[e.createElementVNode("div",x,[e.renderSlot(t.$slots,"vch__legend-left")]),e.createElementVNode("div",ee,[e.renderSlot(t.$slots,"legend-right",{},()=>[e.createElementVNode("div",te,[e.createElementVNode("div",null,e.toDisplayString(t.lo.less),1),t.vertical?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("svg",{key:0,class:"vch__external-legend-wrapper",viewBox:t.legendViewbox,height:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE},[e.createElementVNode("g",ne,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.curRangeColor,(_,h)=>(e.openBlock(),e.createElementBlock("rect",{key:h,rx:t.round,ry:t.round,style:e.normalizeStyle({fill:_}),width:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,height:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,x:t.SQUARE_SIZE*h},null,12,re))),128))])],8,ae)),e.createElementVNode("div",null,e.toDisplayString(t.lo.more),1)])])])])])],2)}const U=F(M,[["render",oe]]);function le(t){t.component(U.name,U)}const se={install:le};i.CalendarHeatmap=U,i.Heatmap=o,i.default=se,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=vue3-calendar-heatmap.umd.js.map
